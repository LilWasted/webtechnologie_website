extends layout

block content
  div(class='w3-container w3-padding-large')
    form(method='POST', style='max-width: 600px; margin: 0 auto; padding: 20px; border: 2px solid #333; border-radius: 10px; background-color: #333; text-align: center;')
      h1= title
      // Title input field
      div.form-group(style='margin-bottom: 20px;')
        label(for='title' style=' display: block; margin-bottom: 5px;') Title:
        input.w3-input.w3-border.w3-round-large#title.form-control(type='text', placeholder='Name of event', name='title', required value=(undefined === event ? '' : event.title), style='width: 100%;')

      // Summary textarea field
      div.form-group(style='margin-bottom: 20px;')
        label(for='description' style=' display: block; margin-bottom: 5px;') Summary:
        textarea.w3-input.w3-border.w3-round-large#description.form-control(placeholder='Description', name='description', style='width: 100%; height: 80px; padding: 10px; background-color: #f1f1f1; resize: vertical;')

      // Platform select field
      div.form-group(style='margin-bottom: 20px;')
        label(for='platform' style=' display: block; margin-bottom: 5px;') Platform:
        select.w3-input.w3-border.w3-round-large#platform.form-control(name='platform', required style='max-height: 40px; width: 100%;')
          option(value='PC') PC
          option(value='PS') PS
          option(value='xbox') Xbox
          option(value='switch') Switch

      // Game search input field
      div.form-group(style='margin-bottom: 20px;')
        label(for='game' style=' display: block; margin-bottom: 5px;') Game:
        input.w3-input.w3-border.w3-round-large#game.form-control(type='text', placeholder='Search games...', oninput="filtergames()", required style='width: 100%;')
        // Custom dropdown menu
        div#game-list(style=' max-width: 600px; width: 100%;   background-color: #fff; display: none; color: black; border-radius: 10px;')
          each game in games
            div.game-item(style='padding: 10px; cursor: pointer;')
              span= game.name
              input(type='hidden', value=game._id, class='game-id')

      // Date and time input field
      div.form-group(style='margin-bottom: 20px;')
        label(for='date' style=' display: block; margin-bottom: 5px;') Date and Time of Event:
        input.w3-input.w3-border.w3-round-large#date.form-control(type='datetime-local', name='date', required value=(event && event.date ? event.date.toISOString().slice(0, 16) : ''), style='width: 100%;')

      // Max participants input field
      div.form-group(style='margin-bottom: 20px;')
        label(for='max_size' style=' display: block; margin-bottom: 5px;') Maximal participants (including yourself):
        input.w3-input.w3-border.w3-round-large#max_size.form-control(type='number', name='max_size', value=(event && event.max_size !== undefined ? event.max_size : ""), min='1', max='40', required style='width: 100%;')

      // Submit button
      button.w3-button.w3-blue.w3-hover-light-blue.w3-round-large(type='submit') Submit

    // Error display if any
    if errors
      ul(style='color: red;')
        each error in errors
          li= error.msg
  style.
    form label {
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
      display: block;
    }

    .game-item:hover {
      background-color: #f0f0f0; /* Change to your desired hover color */
      border-radius: 10px;
    }

    #game-list {
      max-height: 160px; /* Approx 4 items if each is 40px tall */
      overflow-y: auto;
      border: 1px solid #ccc; /* Optional: To give a visual separation */
      padding: 5px;
    }

    /* Optional: Style the scrollbar */
    #game-list::-webkit-scrollbar {
      width: 8px;
    }

    #game-list::-webkit-scrollbar-thumb {
      background: #888; /* Scrollbar color */
      border-radius: 4px;
    }

    #game-list::-webkit-scrollbar-thumb:hover {
      background: #555;
    }


  script.
    function filtergames() {
      const searchTerm = document.getElementById('game').value.trim(); // Trim to handle accidental spaces
      const gameItems = document.querySelectorAll('.game-item');
      const gameList = document.getElementById('game-list');

      let anyVisible = false;

      gameItems.forEach(function (item) {
        const gameName = item.querySelector('span').textContent;

        if (gameName.toLowerCase().includes(searchTerm.toLowerCase())) {
          item.style.display = 'block';
          anyVisible = true;
        } else {
          item.style.display = 'none';
        }
      });

      gameList.style.display = anyVisible ? 'block' : 'none';
    }

    // Event listener for selecting a game
    document.addEventListener('click', function (event) {
      const gameList = document.getElementById('game-list');
      const gameInput = document.getElementById('game');

      if (event.target.closest('#game-list .game-item')) {
        // Clicked on a dropdown item
        const selectedGame = event.target.closest('.game-item');
        const gameName = selectedGame.querySelector('span').textContent;
        const gameId = selectedGame.querySelector('.game-id').value;

        gameInput.value = gameName; // Set input value to selected game name
        gameInput.dataset.selectedId = gameId; // Store ID in a data attribute for later use

        gameList.style.display = 'none'; // Hide dropdown
      } else if (!event.target.closest('#game')) {
        // Hide the dropdown if clicked outside the input or dropdown
        gameList.style.display = 'none';
      }
    });

    // Show dropdown again on input focus
    document.getElementById('game').addEventListener('focus', function () {
      const gameList = document.getElementById('game-list');
      if (this.value.trim() !== '') {
        gameList.style.display = 'block';
      }
    });
